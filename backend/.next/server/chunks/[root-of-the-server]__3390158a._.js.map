{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6HAAA,CAAA,eAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/app/api/users/visible/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\n// Handle CORS preflight requests\nexport async function OPTIONS(request: NextRequest) {\n  return new NextResponse(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': 'http://localhost:3000',\n      'Access-Control-Allow-Methods': 'GET, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}\n\n// GET - получить список видимых пользователей (для поиска специалистов)\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userType = searchParams.get('userType'); // 'INDIVIDUAL' | 'BUSINESS'\n    const acceptsJobs = searchParams.get('acceptsJobs') === 'true';\n    const search = searchParams.get('search'); // поиск по имени, компании или услугам\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const offset = (page - 1) * limit;\n\n    // Построить условия фильтрации\n    const where: any = {\n      isActive: true,\n      isDeleted: false,\n      isVisibleToClients: true\n    };\n\n    if (userType) {\n      where.userType = userType;\n    }\n\n    if (acceptsJobs) {\n      where.acceptsJobOffers = true;\n    }\n\n    if (search) {\n      where.OR = [\n        {\n          name: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        },\n        {\n          company: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        },\n        {\n          services: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        }\n      ];\n    }\n\n    // Получить пользователей с пагинацией\n    const [users, total] = await Promise.all([\n      prisma.user.findMany({\n        where,\n        select: {\n          id: true,\n          name: true,\n          userType: true,\n          company: true,\n          services: true,\n          avatar: true,\n          phone: true,\n          website: true,\n          acceptsJobOffers: true,\n          createdAt: true\n        },\n        orderBy: {\n          createdAt: 'desc'\n        },\n        skip: offset,\n        take: limit\n      }),\n      prisma.user.count({ where })\n    ]);\n\n    const totalPages = Math.ceil(total / limit);\n\n    return NextResponse.json({\n      users,\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages,\n        hasNext: page < totalPages,\n        hasPrev: page > 1\n      }\n    }, { \n      status: 200,\n      headers: {\n        'Access-Control-Allow-Origin': 'http://localhost:3000',\n        'Access-Control-Allow-Methods': 'GET, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type',\n      }\n    });\n\n  } catch (error) {\n    console.error('Get visible users error:', error);\n    return NextResponse.json(\n      { error: 'Внутренняя ошибка сервера' },\n      { status: 500,\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,QAAQ,OAAoB;IAChD,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,MAAM;QAC5B,QAAQ;QACR,SAAS;YACP,+BAA+B;YAC/B,gCAAgC;YAChC,gCAAgC;QAClC;IACF;AACF;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC,aAAa,4BAA4B;QAC3E,MAAM,cAAc,aAAa,GAAG,CAAC,mBAAmB;QACxD,MAAM,SAAS,aAAa,GAAG,CAAC,WAAW,uCAAuC;QAClF,MAAM,OAAO,SAAS,aAAa,GAAG,CAAC,WAAW;QAClD,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;QAE5B,+BAA+B;QAC/B,MAAM,QAAa;YACjB,UAAU;YACV,WAAW;YACX,oBAAoB;QACtB;QAEA,IAAI,UAAU;YACZ,MAAM,QAAQ,GAAG;QACnB;QAEA,IAAI,aAAa;YACf,MAAM,gBAAgB,GAAG;QAC3B;QAEA,IAAI,QAAQ;YACV,MAAM,EAAE,GAAG;gBACT;oBACE,MAAM;wBACJ,UAAU;wBACV,MAAM;oBACR;gBACF;gBACA;oBACE,SAAS;wBACP,UAAU;wBACV,MAAM;oBACR;gBACF;gBACA;oBACE,UAAU;wBACR,UAAU;wBACV,MAAM;oBACR;gBACF;aACD;QACH;QAEA,sCAAsC;QACtC,MAAM,CAAC,OAAO,MAAM,GAAG,MAAM,QAAQ,GAAG,CAAC;YACvC,sHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACnB;gBACA,QAAQ;oBACN,IAAI;oBACJ,MAAM;oBACN,UAAU;oBACV,SAAS;oBACT,UAAU;oBACV,QAAQ;oBACR,OAAO;oBACP,SAAS;oBACT,kBAAkB;oBAClB,WAAW;gBACb;gBACA,SAAS;oBACP,WAAW;gBACb;gBACA,MAAM;gBACN,MAAM;YACR;YACA,sHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,KAAK,CAAC;gBAAE;YAAM;SAC3B;QAED,MAAM,aAAa,KAAK,IAAI,CAAC,QAAQ;QAErC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB;YACA,YAAY;gBACV;gBACA;gBACA;gBACA;gBACA,SAAS,OAAO;gBAChB,SAAS,OAAO;YAClB;QACF,GAAG;YACD,QAAQ;YACR,SAAS;gBACP,+BAA+B;gBAC/B,gCAAgC;gBAChC,gCAAgC;YAClC;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;YACR,SAAS;gBACP,+BAA+B;gBAC/B,gCAAgC;gBAChC,gCAAgC;YAClC;QACF;IAEJ;AACF","debugId":null}}]
}