{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6HAAA,CAAA,eAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/app/api/auth/profile/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\ninterface UpdateProfileRequest {\n  userId: string;\n  name?: string;\n  userType?: 'INDIVIDUAL' | 'BUSINESS';\n  phone?: string;\n  address?: string;\n  website?: string;\n  avatar?: string;\n  company?: string;\n  services?: string;\n  isVisibleToClients?: boolean;\n  acceptsJobOffers?: boolean;\n}\n\n// GET - получить профиль пользователя\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userId = searchParams.get('userId');\n\n    if (!userId) {\n      return NextResponse.json(\n        { error: 'userId обязателен' },\n        { status: 400 }\n      );\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { \n        id: userId,\n        isDeleted: false\n      },\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        userType: true,\n        phone: true,\n        address: true,\n        website: true,\n        avatar: true,\n        company: true,\n        services: true,\n        isOAuthUser: true,\n        oauthProvider: true,\n        isVisibleToClients: true,\n        acceptsJobOffers: true,\n        isActive: true,\n        createdAt: true,\n        updatedAt: true,\n        _count: {\n          documents: true\n        }\n      }\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Пользователь не найден' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({ user }, { status: 200 });\n\n  } catch (error) {\n    console.error('Get profile error:', error);\n    return NextResponse.json(\n      { error: 'Внутренняя ошибка сервера' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - обновить профиль пользователя\nexport async function PUT(request: NextRequest) {\n  try {\n    const body: UpdateProfileRequest = await request.json();\n    const { \n      userId,\n      name,\n      userType,\n      phone,\n      address,\n      website,\n      avatar,\n      company,\n      services,\n      isVisibleToClients,\n      acceptsJobOffers\n    } = body;\n\n    if (!userId) {\n      return NextResponse.json(\n        { error: 'userId обязателен' },\n        { status: 400 }\n      );\n    }\n\n    // Check if user exists and is active\n    const existingUser = await prisma.user.findUnique({\n      where: { \n        id: userId,\n        isDeleted: false\n      }\n    });\n\n    if (!existingUser) {\n      return NextResponse.json(\n        { error: 'Пользователь не найден' },\n        { status: 404 }\n      );\n    }\n\n    if (!existingUser.isActive) {\n      return NextResponse.json(\n        { error: 'Аккаунт деактивирован' },\n        { status: 403 }\n      );\n    }\n\n    // Prepare update data (only include fields that are provided)\n    const updateData: any = {};\n    if (name !== undefined) updateData.name = name;\n    if (userType !== undefined) updateData.userType = userType;\n    if (phone !== undefined) updateData.phone = phone;\n    if (address !== undefined) updateData.address = address;\n    if (website !== undefined) updateData.website = website;\n    if (avatar !== undefined) updateData.avatar = avatar;\n    if (company !== undefined) updateData.company = company;\n    if (services !== undefined) updateData.services = services;\n    if (isVisibleToClients !== undefined) updateData.isVisibleToClients = isVisibleToClients;\n    if (acceptsJobOffers !== undefined) updateData.acceptsJobOffers = acceptsJobOffers;\n\n    // Update user\n    const updatedUser = await prisma.user.update({\n      where: { id: userId },\n      data: updateData,\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        userType: true,\n        phone: true,\n        address: true,\n        website: true,\n        avatar: true,\n        company: true,\n        services: true,\n        isOAuthUser: true,\n        oauthProvider: true,\n        isVisibleToClients: true,\n        acceptsJobOffers: true,\n        isActive: true,\n        createdAt: true,\n        updatedAt: true\n      }\n    });\n\n    return NextResponse.json({\n      message: 'Профиль успешно обновлен',\n      user: updatedUser\n    }, { status: 200 });\n\n  } catch (error) {\n    console.error('Update profile error:', error);\n    return NextResponse.json(\n      { error: 'Внутренняя ошибка сервера' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE - деактивировать/удалить аккаунт\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userId = searchParams.get('userId');\n    const permanent = searchParams.get('permanent') === 'true';\n\n    if (!userId) {\n      return NextResponse.json(\n        { error: 'userId обязателен' },\n        { status: 400 }\n      );\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { id: userId }\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Пользователь не найден' },\n        { status: 404 }\n      );\n    }\n\n    if (permanent) {\n      // Soft delete - mark as deleted but keep data\n      await prisma.user.update({\n        where: { id: userId },\n        data: {\n          isActive: false,\n          isDeleted: true,\n          isVisibleToClients: false,\n          acceptsJobOffers: false\n        }\n      });\n\n      return NextResponse.json({\n        message: 'Аккаунт успешно удален'\n      }, { status: 200 });\n    } else {\n      // Just deactivate\n      await prisma.user.update({\n        where: { id: userId },\n        data: {\n          isActive: false,\n          isVisibleToClients: false,\n          acceptsJobOffers: false\n        }\n      });\n\n      return NextResponse.json({\n        message: 'Аккаунт деактивирован'\n      }, { status: 200 });\n    }\n\n  } catch (error) {\n    console.error('Delete profile error:', error);\n    return NextResponse.json(\n      { error: 'Внутренняя ошибка сервера' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}