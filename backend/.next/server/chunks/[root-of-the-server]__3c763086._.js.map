{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6HAAA,CAAA,eAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/app/api/files/%5Bid%5D/view/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { readFile } from 'fs/promises'\nimport { prisma } from '@/lib/prisma'\nimport { join } from 'path'\n\n// GET /api/files/[id]/view - просмотр файла\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const userId = searchParams.get('userId')\n\n    if (!userId) {\n      return NextResponse.json(\n        { error: 'User ID is required' },\n        { status: 400 }\n      )\n    }\n\n    // Получаем информацию о документе\n    const document = await prisma.document.findFirst({\n      where: {\n        id: params.id,\n        userId,\n      },\n    })\n\n    if (!document) {\n      return NextResponse.json(\n        { error: 'Document not found' },\n        { status: 404 }\n      )\n    }\n\n    try {\n      // Читаем файл\n      const fileBuffer = await readFile(document.filePath)\n      \n      // Определяем Content-Type на основе MIME типа\n      const headers = new Headers()\n      headers.set('Content-Type', document.mimeType)\n      headers.set('Content-Disposition', `inline; filename=\"${document.originalName}\"`)\n      headers.set('Access-Control-Allow-Origin', 'http://localhost:3000')\n      headers.set('Cache-Control', 'public, max-age=3600') // Кэшируем на 1 час\n      \n      return new NextResponse(fileBuffer, {\n        status: 200,\n        headers,\n      })\n    } catch (fileError) {\n      console.error('Error reading file:', fileError)\n      return NextResponse.json(\n        { error: 'File not found on disk' },\n        { status: 404 }\n      )\n    }\n  } catch (error) {\n    console.error('Error serving file:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAIO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAA8B;IAEtC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,CAAC,QAAQ;YACX,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,kCAAkC;QAClC,MAAM,WAAW,MAAM,sHAAA,CAAA,SAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC/C,OAAO;gBACL,IAAI,OAAO,EAAE;gBACb;YACF;QACF;QAEA,IAAI,CAAC,UAAU;YACb,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI;YACF,cAAc;YACd,MAAM,aAAa,MAAM,CAAA,GAAA,qHAAA,CAAA,WAAQ,AAAD,EAAE,SAAS,QAAQ;YAEnD,8CAA8C;YAC9C,MAAM,UAAU,IAAI;YACpB,QAAQ,GAAG,CAAC,gBAAgB,SAAS,QAAQ;YAC7C,QAAQ,GAAG,CAAC,uBAAuB,CAAC,kBAAkB,EAAE,SAAS,YAAY,CAAC,CAAC,CAAC;YAChF,QAAQ,GAAG,CAAC,+BAA+B;YAC3C,QAAQ,GAAG,CAAC,iBAAiB,yBAAwB,oBAAoB;YAEzE,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,YAAY;gBAClC,QAAQ;gBACR;YACF;QACF,EAAE,OAAO,WAAW;YAClB,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}