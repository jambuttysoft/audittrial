{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/app/api/digitized/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\nimport { headers } from 'next/headers';\n\nconst prisma = new PrismaClient();\n\n// CORS headers\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n};\n\nexport async function OPTIONS() {\n  return new NextResponse(null, { status: 200, headers: corsHeaders });\n}\n\n// GET - получить все оцифрованные документы для компании\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const companyId = searchParams.get('companyId');\n    const userId = searchParams.get('userId');\n\n    if (!companyId || !userId) {\n      return NextResponse.json(\n        { error: 'Company ID and User ID are required' },\n        { status: 400, headers: corsHeaders }\n      );\n    }\n\n    const digitizedDocuments = await prisma.Digitized.findMany({\n      where: {\n        companyId,\n        userId,\n      },\n      orderBy: {\n        digitizedAt: 'desc',\n      },\n    });\n\n    return NextResponse.json({\n      success: true,\n      digitized: digitizedDocuments\n    }, { headers: corsHeaders });\n  } catch (error) {\n    console.error('Error fetching digitized documents:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch digitized documents' },\n      { status: 500, headers: corsHeaders }\n    );\n  }\n}\n\n// POST - создать новую запись оцифрованного документа\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const {\n      companyId,\n      userId,\n      originalDocumentId,\n      fileName,\n      filePath,\n      fileSize,\n      mimeType,\n      purchaseDate,\n      vendorName,\n      vendorAbn,\n      vendorAddress,\n      documentType,\n      receiptNumber,\n      paymentType,\n      amountExclTax,\n      taxAmount,\n      totalAmount,\n      expenseCategory,\n      taxStatus,\n    } = body;\n\n    if (!companyId || !userId || !originalDocumentId) {\n      return NextResponse.json(\n        { error: 'Company ID, User ID, and Original Document ID are required' },\n        { status: 400, headers: corsHeaders }\n      );\n    }\n\n    // Создаем запись в таблице Digitized\n    const digitizedDocument = await prisma.Digitized.create({\n      data: {\n        companyId,\n        userId,\n        originalDocumentId,\n        fileName,\n        filePath,\n        fileSize,\n        mimeType,\n        purchaseDate: purchaseDate ? new Date(purchaseDate) : null,\n        vendorName,\n        vendorAbn,\n        vendorAddress,\n        documentType,\n        receiptNumber,\n        paymentType,\n        amountExclTax,\n        taxAmount,\n        totalAmount,\n        expenseCategory,\n        taxStatus,\n      },\n    });\n\n    return NextResponse.json(digitizedDocument, { \n      status: 201, \n      headers: corsHeaders \n    });\n  } catch (error) {\n    console.error('Error creating digitized document:', error);\n    return NextResponse.json(\n      { error: 'Failed to create digitized document' },\n      { status: 500, headers: corsHeaders }\n    );\n  }\n}\n\n// DELETE - удалить оцифрованный документ\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get('id');\n    const userId = searchParams.get('userId');\n\n    if (!id || !userId) {\n      return NextResponse.json(\n        { error: 'Document ID and User ID are required' },\n        { status: 400, headers: corsHeaders }\n      );\n    }\n\n    // Проверяем, что документ принадлежит пользователю\n    const digitizedDocument = await prisma.Digitized.findFirst({\n      where: {\n        id,\n        userId,\n      },\n    });\n\n    if (!digitizedDocument) {\n      return NextResponse.json(\n        { error: 'Document not found or access denied' },\n        { status: 404, headers: corsHeaders }\n      );\n    }\n\n    await prisma.Digitized.delete({\n      where: { id },\n    });\n\n    return NextResponse.json(\n      { message: 'Document deleted successfully' },\n      { headers: corsHeaders }\n    );\n  } catch (error) {\n    console.error('Error deleting digitized document:', error);\n    return NextResponse.json(\n      { error: 'Failed to delete document' },\n      { status: 500, headers: corsHeaders }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}