{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6HAAA,CAAA,eAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/app/api/users/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\n\n// Handle CORS preflight requests\nexport async function OPTIONS(request: NextRequest) {\n  return new NextResponse(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': 'http://localhost:3000',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}\n\n// GET /api/users - получить всех пользователей (админ функция)\nexport async function GET() {\n  try {\n    const users = await prisma.user.findMany({\n      where: {\n        isDeleted: false\n      },\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        userType: true,\n        company: true,\n        isOAuthUser: true,\n        oauthProvider: true,\n        isActive: true,\n        isVisibleToClients: true,\n        acceptsJobOffers: true,\n        createdAt: true,\n        _count: {\n          documents: true,\n        },\n      },\n      orderBy: {\n        createdAt: 'desc',\n      },\n    })\n\n    return NextResponse.json(users, {\n      headers: {\n        'Access-Control-Allow-Origin': 'http://localhost:3000',\n        'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type',\n      }\n    })\n  } catch (error) {\n    console.error('Error fetching users:', error)\n    return NextResponse.json(\n      { error: 'Внутренняя ошибка сервера' },\n      { status: 500,\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    )\n  }\n}\n\n// POST /api/users - создать нового пользователя (админ функция)\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { email, name, userType = 'INDIVIDUAL', company, services } = body\n\n    if (!email) {\n      return NextResponse.json(\n        { error: 'Email обязателен' },\n        { status: 400,\n          headers: {\n            'Access-Control-Allow-Origin': 'http://localhost:3000',\n            'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n          }\n        }\n      )\n    }\n\n    // Проверяем, существует ли пользователь с таким email\n    const existingUser = await prisma.user.findUnique({\n      where: { email },\n    })\n\n    if (existingUser) {\n      return NextResponse.json(\n        { error: 'Пользователь с таким email уже существует' },\n        { status: 409,\n          headers: {\n            'Access-Control-Allow-Origin': 'http://localhost:3000',\n            'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n          }\n        }\n      )\n    }\n\n    const user = await prisma.user.create({\n      data: {\n        email,\n        name,\n        userType,\n        company,\n        services,\n        isActive: true,\n        isDeleted: false\n      },\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        userType: true,\n        company: true,\n        services: true,\n        isActive: true,\n        createdAt: true\n      }\n    })\n\n    return NextResponse.json({\n      message: 'Пользователь успешно создан',\n      user\n    }, { \n      status: 201,\n      headers: {\n        'Access-Control-Allow-Origin': 'http://localhost:3000',\n        'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type',\n      }\n    })\n  } catch (error) {\n    console.error('Error creating user:', error)\n    return NextResponse.json(\n      { error: 'Внутренняя ошибка сервера' },\n      { status: 500,\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    )\n  }\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;AAGO,eAAe,QAAQ,OAAoB;IAChD,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,MAAM;QAC5B,QAAQ;QACR,SAAS;YACP,+BAA+B;YAC/B,gCAAgC;YAChC,gCAAgC;QAClC;IACF;AACF;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,MAAM,sHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACvC,OAAO;gBACL,WAAW;YACb;YACA,QAAQ;gBACN,IAAI;gBACJ,OAAO;gBACP,MAAM;gBACN,UAAU;gBACV,SAAS;gBACT,aAAa;gBACb,eAAe;gBACf,UAAU;gBACV,oBAAoB;gBACpB,kBAAkB;gBAClB,WAAW;gBACX,QAAQ;oBACN,WAAW;gBACb;YACF;YACA,SAAS;gBACP,WAAW;YACb;QACF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,OAAO;YAC9B,SAAS;gBACP,+BAA+B;gBAC/B,gCAAgC;gBAChC,gCAAgC;YAClC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;YACR,SAAS;gBACP,+BAA+B;gBAC/B,gCAAgC;gBAChC,gCAAgC;YAClC;QACF;IAEJ;AACF;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,WAAW,YAAY,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG;QAEpE,IAAI,CAAC,OAAO;YACV,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmB,GAC5B;gBAAE,QAAQ;gBACR,SAAS;oBACP,+BAA+B;oBAC/B,gCAAgC;oBAChC,gCAAgC;gBAClC;YACF;QAEJ;QAEA,sDAAsD;QACtD,MAAM,eAAe,MAAM,sHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAChD,OAAO;gBAAE;YAAM;QACjB;QAEA,IAAI,cAAc;YAChB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4C,GACrD;gBAAE,QAAQ;gBACR,SAAS;oBACP,+BAA+B;oBAC/B,gCAAgC;oBAChC,gCAAgC;gBAClC;YACF;QAEJ;QAEA,MAAM,OAAO,MAAM,sHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACpC,MAAM;gBACJ;gBACA;gBACA;gBACA;gBACA;gBACA,UAAU;gBACV,WAAW;YACb;YACA,QAAQ;gBACN,IAAI;gBACJ,OAAO;gBACP,MAAM;gBACN,UAAU;gBACV,SAAS;gBACT,UAAU;gBACV,UAAU;gBACV,WAAW;YACb;QACF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF,GAAG;YACD,QAAQ;YACR,SAAS;gBACP,+BAA+B;gBAC/B,gCAAgC;gBAChC,gCAAgC;YAClC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;YACR,SAAS;gBACP,+BAA+B;gBAC/B,gCAAgC;gBAChC,gCAAgC;YAClC;QACF;IAEJ;AACF","debugId":null}}]
}