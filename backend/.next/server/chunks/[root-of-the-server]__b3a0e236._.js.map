{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/app/api/xero/status/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\n// Handle CORS preflight requests\nexport async function OPTIONS(request: NextRequest) {\n  return new NextResponse(null, {\n    status: 200,\n    headers: {\n        'Access-Control-Allow-Origin': 'http://localhost:3000',\n        'Access-Control-Allow-Methods': 'GET, DELETE, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type',\n      },\n  });\n}\n\n// Get Xero connection status\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userId = searchParams.get('userId');\n    \n    if (!userId) {\n      return NextResponse.json(\n        { error: 'User ID is required' },\n        { \n          status: 400,\n          headers: {\n            'Access-Control-Allow-Origin': 'http://localhost:3000',\n            'Access-Control-Allow-Methods': 'GET, DELETE, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n          }\n        }\n      );\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { id: userId },\n      select: {\n        id: true,\n        xeroAccessToken: true,\n        xeroTokenExpiry: true,\n        xeroTenantId: true,\n        xeroTenantName: true,\n        xeroConnectedAt: true,\n      }\n    });\n    \n    if (!user) {\n      return NextResponse.json(\n        { error: 'User not found' },\n        { \n          status: 404,\n          headers: {\n            'Access-Control-Allow-Origin': 'http://localhost:3000',\n            'Access-Control-Allow-Methods': 'GET, DELETE, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n          }\n        }\n      );\n    }\n\n    const isConnected = !!(user.xeroAccessToken && user.xeroTenantId);\n    const isTokenExpired = user.xeroTokenExpiry ? new Date() > user.xeroTokenExpiry : true;\n    \n    return NextResponse.json(\n      {\n        isConnected,\n        isTokenExpired,\n        tenantName: user.xeroTenantName,\n        connectedAt: user.xeroConnectedAt,\n        needsReconnection: isConnected && isTokenExpired\n      },\n      {\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, DELETE, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    );\n  } catch (error) {\n    console.error('Xero status check error:', error);\n    return NextResponse.json(\n      { error: 'Failed to check Xero status' },\n      { \n        status: 500,\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, DELETE, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    );\n  }\n}\n\n// Disconnect Xero\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userId = searchParams.get('userId');\n    \n    if (!userId) {\n      return NextResponse.json(\n        { error: 'User ID is required' },\n        { \n          status: 400,\n          headers: {\n            'Access-Control-Allow-Origin': 'http://localhost:3000',\n            'Access-Control-Allow-Methods': 'GET, DELETE, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n          }\n        }\n      );\n    }\n\n    // Clear Xero tokens and tenant info\n    await prisma.user.update({\n      where: { id: userId },\n      data: {\n        xeroAccessToken: null,\n        xeroRefreshToken: null,\n        xeroTokenExpiry: null,\n        xeroTenantId: null,\n        xeroTenantName: null,\n        // Keep xeroConnectedAt for historical reference\n      }\n    });\n    \n    return NextResponse.json(\n      { message: 'Xero disconnected successfully' },\n      {\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, DELETE, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    );\n  } catch (error) {\n    console.error('Xero disconnect error:', error);\n    return NextResponse.json(\n      { error: 'Failed to disconnect Xero' },\n      { \n        status: 500,\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, DELETE, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}