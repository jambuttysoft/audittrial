{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/app/api/abn-lookup/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const abn = searchParams.get('abn')\n  \n  // Добавляем CORS заголовки\n  const corsHeaders = {\n    'Access-Control-Allow-Origin': 'http://localhost:3000',\n    'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n  }\n  \n  if (!abn) {\n    return NextResponse.json(\n      { error: 'ABN parameter is required' },\n      { status: 400, headers: corsHeaders }\n    )\n  }\n  \n  // Проверяем формат ABN (11 цифр)\n  const abnRegex = /^\\d{11}$/\n  if (!abnRegex.test(abn)) {\n    return NextResponse.json(\n      { error: 'Invalid ABN format. ABN must be 11 digits.' },\n      { status: 400, headers: corsHeaders }\n    )\n  }\n  \n  const apiKey = process.env.ABN_API_KEY\n  if (!apiKey) {\n    return NextResponse.json(\n      { error: 'ABN API key not configured' },\n      { status: 500, headers: corsHeaders }\n    )\n  }\n  \n  try {\n    // Используем JSON ABN Lookup API\n    const abnApiUrl = `https://abr.business.gov.au/json/AbnDetails.aspx?abn=${abn}&callback=callback&guid=${apiKey}`\n    \n    const response = await fetch(abnApiUrl, {\n      method: 'GET',\n      headers: {\n        'Accept': 'application/javascript',\n        'User-Agent': 'AuditTrial-App/1.0'\n      }\n    })\n    \n    if (!response.ok) {\n      return NextResponse.json(\n        { error: 'Failed to fetch ABN data from government API' },\n        { status: response.status, headers: corsHeaders }\n      )\n    }\n    \n    const responseText = await response.text()\n    \n    // Парсим JSONP ответ (убираем callback())\n    const jsonMatch = responseText.match(/callback\\((.+)\\)$/)\n    if (!jsonMatch) {\n      return NextResponse.json(\n        { error: 'Invalid response format from ABN API' },\n        { status: 500, headers: corsHeaders }\n      )\n    }\n    \n    const abnData = JSON.parse(jsonMatch[1])\n    \n    // Проверяем наличие ошибок\n    if (abnData.Message && abnData.Message.trim() !== '') {\n      return NextResponse.json(\n        { error: abnData.Message },\n        { status: 400, headers: corsHeaders }\n      )\n    }\n    \n    return NextResponse.json(abnData, { headers: corsHeaders })\n    \n  } catch (error) {\n    console.error('Error fetching ABN data:', error)\n    return NextResponse.json(\n      { error: 'Internal server error while fetching ABN data' },\n      { status: 500, headers: corsHeaders }\n    )\n  }\n}\n\n// Добавляем обработчик OPTIONS для CORS preflight запросов\nexport async function OPTIONS(request: NextRequest) {\n  return new Response(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': 'http://localhost:3000',\n      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n    },\n  })\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,MAAM,aAAa,GAAG,CAAC;IAE7B,2BAA2B;IAC3B,MAAM,cAAc;QAClB,+BAA+B;QAC/B,gCAAgC;QAChC,gCAAgC;IAClC;IAEA,IAAI,CAAC,KAAK;QACR,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;YAAK,SAAS;QAAY;IAExC;IAEA,iCAAiC;IACjC,MAAM,WAAW;IACjB,IAAI,CAAC,SAAS,IAAI,CAAC,MAAM;QACvB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6C,GACtD;YAAE,QAAQ;YAAK,SAAS;QAAY;IAExC;IAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,WAAW;IACtC,IAAI,CAAC,QAAQ;QACX,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;YAAK,SAAS;QAAY;IAExC;IAEA,IAAI;QACF,iCAAiC;QACjC,MAAM,YAAY,CAAC,qDAAqD,EAAE,IAAI,wBAAwB,EAAE,QAAQ;QAEhH,MAAM,WAAW,MAAM,MAAM,WAAW;YACtC,QAAQ;YACR,SAAS;gBACP,UAAU;gBACV,cAAc;YAChB;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA+C,GACxD;gBAAE,QAAQ,SAAS,MAAM;gBAAE,SAAS;YAAY;QAEpD;QAEA,MAAM,eAAe,MAAM,SAAS,IAAI;QAExC,0CAA0C;QAC1C,MAAM,YAAY,aAAa,KAAK,CAAC;QACrC,IAAI,CAAC,WAAW;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuC,GAChD;gBAAE,QAAQ;gBAAK,SAAS;YAAY;QAExC;QAEA,MAAM,UAAU,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;QAEvC,2BAA2B;QAC3B,IAAI,QAAQ,OAAO,IAAI,QAAQ,OAAO,CAAC,IAAI,OAAO,IAAI;YACpD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,QAAQ,OAAO;YAAC,GACzB;gBAAE,QAAQ;gBAAK,SAAS;YAAY;QAExC;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,SAAS;YAAE,SAAS;QAAY;IAE3D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAgD,GACzD;YAAE,QAAQ;YAAK,SAAS;QAAY;IAExC;AACF;AAGO,eAAe,QAAQ,OAAoB;IAChD,OAAO,IAAI,SAAS,MAAM;QACxB,QAAQ;QACR,SAAS;YACP,+BAA+B;YAC/B,gCAAgC;YAChC,gCAAgC;QAClC;IACF;AACF","debugId":null}}]
}