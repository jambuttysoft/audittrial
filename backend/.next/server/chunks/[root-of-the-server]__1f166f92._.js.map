{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/extdisk/WORK/audittrial/backend/src/app/api/xero/auth/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { XeroClient } from 'xero-node';\n\n// Initialize Xero client using environment variables\nconst getXeroClient = () => {\n  const client_id: string = process.env.XERO_CLIENT_ID!;\n  const client_secret: string = process.env.XERO_CLIENT_SECRET!;\n  const redirectUrl: string = process.env.XERO_REDIRECT_URI!;\n  const scopes: string = process.env.XERO_SCOPES || 'openid profile email accounting.settings accounting.reports.read accounting.journals.read accounting.contacts accounting.attachments accounting.transactions offline_access';\n\n  console.log('=== XERO AUTH CLIENT INITIALIZATION DEBUG ===');\n  console.log('client_id:', client_id ? `${client_id.substring(0, 8)}...` : 'MISSING');\n  console.log('client_secret:', client_secret ? `${client_secret.substring(0, 8)}...` : 'MISSING');\n  console.log('redirectUrl:', redirectUrl);\n  console.log('scopes:', scopes.split(' '));\n  console.log('XERO_SCOPES env var:', process.env.XERO_SCOPES);\n\n  if (!client_id || !client_secret || !redirectUrl) {\n    const error = `Environment Variables not all set - client_id=${!!client_id}, client_secret=${!!client_secret}, redirectUrl=${!!redirectUrl}`;\n    console.error('ERROR:', error);\n    throw Error(error);\n  }\n\n  const xeroConfig = {\n    clientId: client_id,\n    clientSecret: client_secret,\n    redirectUris: [redirectUrl],\n    scopes: scopes.split(' '),\n  };\n  \n  console.log('XeroClient auth config:', {\n    ...xeroConfig,\n    clientSecret: '[HIDDEN]'\n  });\n\n  try {\n    const client = new XeroClient(xeroConfig);\n    console.log('XeroClient for auth created successfully');\n    return client;\n  } catch (error) {\n    console.error('Error creating XeroClient for auth:', error);\n    throw error;\n  }\n};\n\n// Handle CORS preflight requests\nexport async function OPTIONS(request: NextRequest) {\n  return new NextResponse(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': 'http://localhost:3000',\n      'Access-Control-Allow-Methods': 'GET, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userId = searchParams.get('userId');\n    \n    if (!userId) {\n      return NextResponse.json(\n        { error: 'User ID is required' },\n        { \n          status: 400,\n          headers: {\n            'Access-Control-Allow-Origin': 'http://localhost:3000',\n            'Access-Control-Allow-Methods': 'GET, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n          }\n        }\n      );\n    }\n\n    // Validate environment variables\n    if (!process.env.XERO_CLIENT_ID || !process.env.XERO_CLIENT_SECRET || !process.env.XERO_REDIRECT_URI) {\n      return NextResponse.json(\n        { error: 'Xero configuration is missing. Please check environment variables.' },\n        { \n          status: 500,\n          headers: {\n            'Access-Control-Allow-Origin': 'http://localhost:3000',\n            'Access-Control-Allow-Methods': 'GET, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n          }\n        }\n      );\n    }\n\n    const xero = getXeroClient();\n    \n    // Build consent URL with user ID in state\n    const consentUrl = await xero.buildConsentUrl();\n    const urlWithUserId = `${consentUrl}&state=${encodeURIComponent(`userId=${userId}`)}`;\n    \n    return NextResponse.json(\n      { authUrl: urlWithUserId },\n      {\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    );\n  } catch (error) {\n    console.error('Xero auth error:', error);\n    return NextResponse.json(\n      { error: 'Failed to generate Xero authorization URL' },\n      { \n        status: 500,\n        headers: {\n          'Access-Control-Allow-Origin': 'http://localhost:3000',\n          'Access-Control-Allow-Methods': 'GET, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type',\n        }\n      }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}